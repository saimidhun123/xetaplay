<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Xeta Play | Ultimate Casual Gaming</title>
    
    <!-- Fonts -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700&family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* * =========================================
         * CORE THEME VARIABLES
         * =========================================
         */
        :root {
            --bg-dark: #09090b;       /* Ultra dark background */
            --bg-panel: #18181b;      /* Panel background */
            --bg-card: #27272a;       /* Card background */
            
            --primary: #00f0ff;       /* Cyberpunk Cyan */
            --primary-dim: rgba(0, 240, 255, 0.1);
            
            --secondary: #ff0055;     /* Neon Pink */
            --secondary-dim: rgba(255, 0, 85, 0.1);
            
            --accent: #7000ff;        /* Electric Purple */
            
            --text-main: #ffffff;
            --text-muted: #a1a1aa;
            
            --font-ui: 'Outfit', sans-serif;
            --font-display: 'Rajdhani', sans-serif;
            
            --glass: rgba(24, 24, 27, 0.85);
            --border-glow: 0 0 10px rgba(0, 240, 255, 0.3);
            --radius-md: 12px;
            --radius-lg: 24px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(112, 0, 255, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(0, 240, 255, 0.05) 0%, transparent 40%);
            color: var(--text-main);
            font-family: var(--font-ui);
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- Animations --- */
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        @keyframes pulse-glow { 0% { box-shadow: 0 0 5px var(--primary); } 50% { box-shadow: 0 0 20px var(--primary), 0 0 10px var(--accent); } 100% { box-shadow: 0 0 5px var(--primary); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes popIn { 0% { opacity: 0; transform: scale(0.8); } 70% { transform: scale(1.05); } 100% { opacity: 1; transform: scale(1); } }

        /* --- Utilities --- */
        .hidden { display: none !important; }
        .view-section { animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1); width: 100%; }
        
        /* --- Buttons --- */
        .btn {
            padding: 12px 30px;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            font-family: var(--font-display);
            font-weight: 700;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        
        .btn-primary {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            box-shadow: 0 0 15px var(--primary-dim);
        }
        .btn-primary::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: var(--primary); z-index: -1; transition: 0.4s;
        }
        .btn-primary:hover::before { left: 0; }
        .btn-primary:hover { color: #000; box-shadow: 0 0 25px var(--primary); }
        
        .btn-secondary {
            background: var(--secondary);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 0, 85, 0.4);
        }
        .btn-secondary:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(255, 0, 85, 0.6); }

        .btn-icon {
            padding: 10px; width: 45px; height: 45px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
        }

        /* --- Navigation --- */
        nav {
            background: var(--glass);
            backdrop-filter: blur(16px);
            padding: 0.8rem 5%;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(255,255,255,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-logo img { height: 45px; width: auto; display: block; filter: drop-shadow(0 0 8px rgba(0,240,255,0.3)); }
        
        .nav-links { display: flex; gap: 2rem; }
        .nav-item {
            color: var(--text-muted);
            text-decoration: none;
            font-family: var(--font-display);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 1px;
            position: relative;
            transition: 0.3s;
        }
        .nav-item:hover, .nav-item.active { color: var(--primary); text-shadow: 0 0 8px var(--primary); }
        .nav-item::after {
            content: ''; position: absolute; bottom: -5px; left: 0; width: 0; height: 2px;
            background: var(--primary); transition: 0.3s;
        }
        .nav-item:hover::after { width: 100%; }

        /* --- Hero Section --- */
        .hero {
            padding: 6rem 1rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .hero::before {
            content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 600px; height: 600px; background: radial-gradient(circle, var(--primary-dim) 0%, transparent 70%);
            z-index: -1; filter: blur(50px);
        }
        .hero-title {
            font-family: var(--font-display);
            font-size: clamp(3rem, 8vw, 6rem);
            line-height: 0.9;
            margin-bottom: 1.5rem;
            text-transform: uppercase;
            background: linear-gradient(to bottom, #fff, #a1a1aa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.1));
        }
        .hero-title span { color: transparent; -webkit-text-stroke: 1px var(--primary); }
        .hero-subtitle {
            font-size: 1.2rem; color: var(--text-muted); max-width: 600px; margin: 0 auto 3rem; line-height: 1.6;
        }

        /* --- Games Grid --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; width: 100%; }
        .section-header { margin-bottom: 3rem; display: flex; align-items: center; gap: 1rem; }
        .section-title { font-family: var(--font-display); font-size: 2rem; color: white; text-transform: uppercase; }
        .section-line { height: 2px; background: linear-gradient(90deg, var(--secondary), transparent); flex: 1; }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
        }

        .game-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            overflow: hidden;
            position: relative;
            transition: all 0.4s ease;
            border: 1px solid rgba(255,255,255,0.05);
            group-hover: pointer;
            display: flex;
            flex-direction: column;
        }
        .game-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            border-color: var(--primary);
        }
        .card-image-box {
            height: 200px;
            background: #18181b;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        .card-image-box i { font-size: 5rem; color: var(--text-muted); transition: 0.4s; z-index: 2; }
        .game-card:hover .card-image-box i { color: white; transform: scale(1.1); filter: drop-shadow(0 0 15px var(--primary)); }
        
        /* Neon glow behind icon */
        .card-image-box::after {
            content: ''; position: absolute; width: 100px; height: 100px;
            background: var(--game-color); border-radius: 50%; filter: blur(40px); opacity: 0.2;
            transition: 0.4s;
        }
        .game-card:hover .card-image-box::after { opacity: 0.6; width: 150px; height: 150px; }

        .card-content { padding: 1.5rem; flex: 1; display: flex; flex-direction: column; background: linear-gradient(180deg, rgba(39,39,42,0) 0%, rgba(0,0,0,0.4) 100%); }
        .card-title { font-family: var(--font-display); font-size: 1.5rem; margin-bottom: 0.5rem; color: white; }
        .card-desc { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 1.5rem; line-height: 1.5; flex: 1; }
        .card-play-btn {
            width: 100%; padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.05); color: white; font-weight: 600; cursor: pointer;
            transition: 0.3s; text-transform: uppercase; font-family: var(--font-display); letter-spacing: 1px;
        }
        .card-play-btn:hover { background: var(--game-color); border-color: var(--game-color); color: #000; box-shadow: 0 0 15px var(--game-color); }

        /* --- Active Game UI --- */
        #active-game-view { min-height: 80vh; display: flex; flex-direction: column; align-items: center; }
        
        .game-hud {
            width: 100%; max-width: 900px; display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 2rem; background: rgba(24, 24, 27, 0.6); padding: 1rem 2rem;
            border-radius: 16px; border: 1px solid rgba(255,255,255,0.08); backdrop-filter: blur(10px);
        }
        .hud-stat { display: flex; flex-direction: column; align-items: center; }
        .hud-label { font-size: 0.7rem; text-transform: uppercase; color: var(--text-muted); letter-spacing: 1px; font-weight: 700; }
        .hud-value { font-family: var(--font-display); font-size: 1.8rem; font-weight: 700; color: var(--primary); text-shadow: 0 0 10px var(--primary-dim); }

        .game-canvas-wrapper {
            position: relative;
            padding: 10px;
            background: #111;
            border-radius: 20px;
            box-shadow: 0 0 0 1px rgba(255,255,255,0.1), 0 20px 50px rgba(0,0,0,0.5);
        }
        
        /* --- Custom Popups (Modal) --- */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px);
            z-index: 1000; display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: 0.3s;
        }
        .modal-overlay.active { opacity: 1; pointer-events: all; }
        
        .modal-box {
            background: #18181b; width: 90%; max-width: 450px; padding: 2.5rem;
            border-radius: 24px; text-align: center; position: relative;
            transform: scale(0.8); transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            overflow: hidden;
        }
        .modal-overlay.active .modal-box { transform: scale(1); }
        
        /* Neon line at top of modal */
        .modal-box::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }

        .modal-icon {
            font-size: 3rem; margin-bottom: 1rem;
            background: -webkit-linear-gradient(45deg, var(--primary), var(--accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: float 3s ease-in-out infinite;
        }
        .modal-title { font-family: var(--font-display); font-size: 2rem; margin-bottom: 0.5rem; color: white; text-transform: uppercase; }
        .modal-msg { color: var(--text-muted); margin-bottom: 2rem; line-height: 1.6; }
        
        .modal-actions { display: flex; gap: 1rem; justify-content: center; }

        /* --- Footer --- */
        footer {
            margin-top: auto; padding: 3rem 1rem; text-align: center;
            background: #050505; border-top: 1px solid rgba(255,255,255,0.05);
        }
        .footer-logo { opacity: 0.5; width: 100px; margin-bottom: 1rem; filter: grayscale(1); transition: 0.3s; }
        .footer-logo:hover { opacity: 1; filter: grayscale(0); }
        .legal { font-size: 0.8rem; color: #52525b; max-width: 500px; margin: 0 auto; line-height: 1.5; }

        /* --- Responsive --- */
        @media (max-width: 768px) {
            .nav-links { display: none; } /* Simplified for mobile */
            .game-hud { flex-direction: column; gap: 1rem; padding: 1rem; }
            .hero-title { font-size: 3rem; }
            .container { padding: 1rem; }
            .game-canvas-wrapper { width: 100%; display: flex; justify-content: center; }
        }

        /* --- Game Specific CSS --- */
        /* Puzzle */
        .puzzle-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 4px; width: 300px; height: 300px; background: #27272a; padding: 4px; border-radius: 8px; }
        .puzzle-tile {
            background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; display: flex; align-items: center; justify-content: center;
            font-family: var(--font-display); font-size: 1.5rem; font-weight: 700; border-radius: 4px; cursor: pointer;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2); transition: transform 0.1s;
        }
        .puzzle-tile.correct { background: linear-gradient(135deg, #10b981, #059669); }
        .puzzle-tile.empty { background: transparent; cursor: default; box-shadow: none; }
        
        /* Memory */
        .memory-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; width: 320px; height: 320px; }
        .memory-card {
            background: #27272a; border-radius: 8px; cursor: pointer; position: relative; transform-style: preserve-3d; transition: transform 0.5s;
            display: flex; align-items: center; justify-content: center; border: 2px solid rgba(255,255,255,0.05);
        }
        .memory-card.flipped { transform: rotateY(180deg); background: #18181b; border-color: var(--secondary); box-shadow: 0 0 15px rgba(255,0,85,0.3); }
        .memory-card i { font-size: 1.5rem; display: none; }
        .memory-card.flipped i { display: block; transform: rotateY(180deg); color: var(--secondary); }
        
        /* Speed */
        .speed-stage { width: 320px; height: 320px; position: relative; background: radial-gradient(circle, #1a1a1a 0%, #000 100%); border-radius: 12px; overflow: hidden; cursor: crosshair; }
        .speed-target {
            position: absolute; width: 50px; height: 50px; background: var(--secondary); border-radius: 50%;
            box-shadow: 0 0 20px var(--secondary); animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 3px solid #fff;
        }
        
        /* Dots */
        .dot-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; padding: 10px; background: #18181b; border-radius: 12px; width: 320px; height: 320px; }
        .dot { width: 100%; height: 100%; border-radius: 50%; cursor: pointer; transition: 0.2s; position: relative; border: 2px solid rgba(255,255,255,0.1); }
        .dot:hover { transform: scale(1.1); z-index: 5; border-color: white; }
        .dot::after { content: ''; position: absolute; inset: 20%; background: rgba(255,255,255,0.4); border-radius: 50%; filter: blur(2px); }

    </style>
</head>
<body>

    <!-- NAVIGATION -->
    <nav>
        <a href="#" onclick="app.navigate('home')" class="nav-logo">
            <img src="https://res.cloudinary.com/dzuxwvamy/image/upload/v1768757769/Xeta_play_yuhnia.png" alt="Xeta Play">
        </a>
        <div class="nav-links">
            <a href="#" onclick="app.navigate('home')" class="nav-item">Home</a>
            <a href="#" onclick="app.navigate('games')" class="nav-item">All Games</a>
            <a href="#" class="nav-item">Leaderboard</a>
        </div>
        <button class="btn btn-primary" onclick="app.navigate('games')" style="padding: 8px 20px; font-size: 0.8rem;">Play Now</button>
    </nav>

    <!-- CUSTOM MODAL SYSTEM (Replaces Alert) -->
    <div id="modal-overlay" class="modal-overlay">
        <div class="modal-box">
            <div id="modal-icon" class="modal-icon"><i class="fa-solid fa-trophy"></i></div>
            <h2 id="modal-title" class="modal-title">Level Complete</h2>
            <p id="modal-msg" class="modal-msg">You scored 500 points!</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="app.closeModal()">Close</button>
                <button class="btn btn-primary" onclick="app.modalAction()">Play Again</button>
            </div>
        </div>
    </div>

    <!-- VIEW: HOME -->
    <div id="home-view" class="view-section">
        <div class="hero">
            <h1 class="hero-title">Play. <span>Compete.</span><br>Conquer.</h1>
            <p class="hero-subtitle">The next generation of casual gaming is here. Zero downloads, instant action, and neon-soaked aesthetics.</p>
            <button class="btn btn-primary" onclick="app.navigate('games')">Start Playing</button>
        </div>
        
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Trending Now</h2>
                <div class="section-line"></div>
            </div>
            <div class="games-grid" id="featured-grid">
                <!-- Injected via JS -->
            </div>
        </div>
    </div>

    <!-- VIEW: GAMES LIST -->
    <div id="games-view" class="view-section hidden container">
        <div class="section-header">
            <h2 class="section-title">Game Library</h2>
            <div class="section-line"></div>
        </div>
        <div class="games-grid" id="all-games-grid">
            <!-- Injected via JS -->
        </div>
    </div>

    <!-- VIEW: ACTIVE GAME -->
    <div id="active-game-view" class="view-section hidden">
        <div class="container" style="display: flex; flex-direction: column; align-items: center;">
            
            <div class="game-hud">
                <button class="btn-icon btn-secondary" onclick="app.navigate('games')" style="width: 40px; height: 40px;"><i class="fa-solid fa-arrow-left"></i></button>
                
                <div class="hud-stat">
                    <span class="hud-label">Game</span>
                    <span class="hud-value" id="game-title-display" style="font-size: 1.2rem;">Title</span>
                </div>
                
                <div class="hud-stat">
                    <span class="hud-label">Score</span>
                    <span class="hud-value" id="score-display">0</span>
                </div>
                
                <div class="hud-stat">
                    <span class="hud-label">Best</span>
                    <span class="hud-value" id="highscore-display">0</span>
                </div>
                
                <button class="btn-icon btn-primary" id="restart-btn"><i class="fa-solid fa-rotate-right"></i></button>
            </div>

            <div class="game-canvas-wrapper">
                <div id="game-stage-container"></div>
            </div>

            <div id="game-instructions" style="margin-top: 2rem; color: var(--text-muted); text-align: center; max-width: 500px; font-size: 0.9rem;">
                <!-- Injected JS -->
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer>
        <img src="https://res.cloudinary.com/dzuxwvamy/image/upload/v1768757769/Xeta_play_yuhnia.png" alt="Xeta Play" class="footer-logo">
        <p class="legal">
            &copy; 2026 Xeta Solutions. <br>
            <span style="opacity: 0.6; font-size: 0.75rem;">This platform does not support betting, gambling, or real-money gaming. All games are free-to-play for entertainment purposes only.</span>
        </p>
    </footer>

    <!-- LOGIC -->
    <script>
        // --- Game Registry (NO LUDO) ---
        const GAMES_DB = [
            {
                id: 'puzzle',
                title: 'Neon Puzzle',
                desc: 'Slide the glowing tiles to order numbers 1-15.',
                icon: 'fa-cubes-stacked',
                color: '#3b82f6' // Blue
            },
            {
                id: 'memory',
                title: 'Cyber Memory',
                desc: 'Hack the system by matching data pairs.',
                icon: 'fa-microchip',
                color: '#ff0055' // Pink
            },
            {
                id: 'speed',
                title: 'Hyper Click',
                desc: 'Test your reflexes against the machine.',
                icon: 'fa-bolt',
                color: '#10b981' // Green
            },
            {
                id: 'dots',
                title: 'Dot Link',
                desc: 'Connect the energy nodes to clear the grid.',
                icon: 'fa-circle-nodes',
                color: '#eab308' // Yellow
            }
        ];

        // --- App Controller ---
        const app = {
            state: {
                activeGameId: null,
                gameInstance: null,
                currentActionCallback: null
            },
            elements: {
                modal: document.getElementById('modal-overlay'),
                modalTitle: document.getElementById('modal-title'),
                modalMsg: document.getElementById('modal-msg'),
                modalIcon: document.getElementById('modal-icon'),
                gameStage: document.getElementById('game-stage-container'),
                score: document.getElementById('score-display'),
                highScore: document.getElementById('highscore-display'),
                title: document.getElementById('game-title-display'),
                instructions: document.getElementById('game-instructions')
            },

            init() {
                this.renderCards();
                // Basic Routing
                const showView = (id) => {
                    document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
                    document.getElementById(id + '-view').classList.remove('hidden');
                    window.scrollTo(0,0);
                };
                
                this.navigate = (view) => {
                    if (view === 'games' || view === 'home') this.stopGame();
                    showView(view);
                };

                // Restart Listener
                document.getElementById('restart-btn').addEventListener('click', () => {
                    if (this.state.gameInstance) this.state.gameInstance.init();
                });
            },

            renderCards() {
                const gridHtml = GAMES_DB.map(game => `
                    <div class="game-card" style="--game-color: ${game.color}" onclick="app.launchGame('${game.id}')">
                        <div class="card-image-box">
                            <i class="fa-solid ${game.icon}"></i>
                        </div>
                        <div class="card-content">
                            <h3 class="card-title">${game.title}</h3>
                            <p class="card-desc">${game.desc}</p>
                            <button class="card-play-btn">Play Now</button>
                        </div>
                    </div>
                `).join('');
                
                document.getElementById('featured-grid').innerHTML = gridHtml;
                document.getElementById('all-games-grid').innerHTML = gridHtml;
            },

            launchGame(id) {
                const game = GAMES_DB.find(g => g.id === id);
                if (!game) return;

                this.stopGame();
                this.state.activeGameId = id;
                
                // UI Setup
                this.elements.title.innerText = game.title;
                this.elements.title.style.color = game.color;
                this.elements.score.innerText = '0';
                this.elements.highScore.innerText = sessionStorage.getItem(`xp_${id}_high`) || '0';
                
                // Switch View
                document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
                document.getElementById('active-game-view').classList.remove('hidden');
                
                // Init Game
                switch(id) {
                    case 'puzzle': this.state.gameInstance = new PuzzleGame(this.elements.gameStage); break;
                    case 'memory': this.state.gameInstance = new MemoryGame(this.elements.gameStage); break;
                    case 'speed': this.state.gameInstance = new SpeedGame(this.elements.gameStage); break;
                    case 'dots': this.state.gameInstance = new DotsGame(this.elements.gameStage); break;
                }
                
                if (this.state.gameInstance) this.state.gameInstance.init();
            },

            stopGame() {
                if (this.state.gameInstance && this.state.gameInstance.destroy) {
                    this.state.gameInstance.destroy();
                }
                this.state.gameInstance = null;
                this.elements.gameStage.innerHTML = '';
            },

            updateScore(val) {
                this.elements.score.innerText = val;
                const best = parseInt(sessionStorage.getItem(`xp_${this.state.activeGameId}_high`) || '0');
                if (val > best) {
                    sessionStorage.setItem(`xp_${this.state.activeGameId}_high`, val);
                    this.elements.highScore.innerText = val;
                }
            },

            // --- Modal System ---
            showModal(title, msg, iconClass, actionCallback) {
                this.elements.modalTitle.innerText = title;
                this.elements.modalMsg.innerHTML = msg;
                this.elements.modalIcon.innerHTML = `<i class="fa-solid ${iconClass}"></i>`;
                this.state.currentActionCallback = actionCallback;
                this.elements.modal.classList.add('active');
            },
            closeModal() {
                this.elements.modal.classList.remove('active');
            },
            modalAction() {
                this.closeModal();
                if (this.state.currentActionCallback) this.state.currentActionCallback();
            }
        };

        /* ================= GAME ENGINES ================= */

        // 1. NEON PUZZLE
        class PuzzleGame {
            constructor(container) { this.container = container; this.tiles = []; }
            init() {
                app.elements.instructions.innerText = "Click tiles next to the empty space to slide them. Order 1-15 to win.";
                this.tiles = Array.from({length: 15}, (_, i) => i + 1).concat(null);
                this.moves = 0;
                // Simple Shuffle
                for(let i=0; i<200; i++) {
                    const empty = this.tiles.indexOf(null);
                    const neighbors = this.getNeighbors(empty);
                    const rand = neighbors[Math.floor(Math.random() * neighbors.length)];
                    [this.tiles[empty], this.tiles[rand]] = [this.tiles[rand], this.tiles[empty]];
                }
                this.render();
                app.updateScore(0);
            }
            getNeighbors(idx) {
                const moves = [];
                const r = Math.floor(idx/4), c = idx%4;
                if(r>0) moves.push(idx-4); if(r<3) moves.push(idx+4);
                if(c>0) moves.push(idx-1); if(c<3) moves.push(idx+1);
                return moves;
            }
            move(idx) {
                const empty = this.tiles.indexOf(null);
                if (this.getNeighbors(empty).includes(idx)) {
                    [this.tiles[empty], this.tiles[idx]] = [this.tiles[idx], this.tiles[empty]];
                    this.moves++;
                    app.updateScore(this.moves); // Showing moves as score
                    this.render();
                    if (this.tiles.slice(0,15).every((v,i) => v === i+1)) {
                        app.showModal("System Hacked!", `Puzzle solved in ${this.moves} moves.`, "fa-unlock", () => this.init());
                    }
                }
            }
            render() {
                this.container.innerHTML = `<div class="puzzle-grid">
                    ${this.tiles.map((t, i) => `
                        <div class="puzzle-tile ${t===i+1?'correct':''} ${t===null?'empty':''}" onclick="app.state.gameInstance.move(${i})">
                            ${t || ''}
                        </div>
                    `).join('')}
                </div>`;
            }
            destroy() { this.container.innerHTML = ''; }
        }

        // 2. CYBER MEMORY
        class MemoryGame {
            constructor(container) { this.container = container; }
            init() {
                app.elements.instructions.innerText = "Match matched icon pairs. Speed is key.";
                const icons = ['fa-ghost','fa-dragon','fa-meteor','fa-robot','fa-gamepad','fa-rocket','fa-headset','fa-dna'];
                this.cards = [...icons, ...icons].sort(() => Math.random() - 0.5).map(i => ({icon:i, flipped:false, matched:false}));
                this.locked = false; this.first = null; this.matches = 0; this.score = 0;
                this.render();
                app.updateScore(0);
            }
            flip(i) {
                if (this.locked || this.cards[i].flipped || this.cards[i].matched) return;
                this.cards[i].flipped = true;
                this.render();
                
                if (!this.first) {
                    this.first = {i, icon: this.cards[i].icon};
                } else {
                    this.locked = true;
                    if (this.first.icon === this.cards[i].icon) {
                        this.cards[this.first.i].matched = true;
                        this.cards[i].matched = true;
                        this.matches++;
                        this.score += 100;
                        app.updateScore(this.score);
                        this.reset();
                        if (this.matches === 8) app.showModal("Memory Synced", `Total Score: ${this.score}`, "fa-brain", () => this.init());
                    } else {
                        setTimeout(() => {
                            this.cards[this.first.i].flipped = false;
                            this.cards[i].flipped = false;
                            this.reset();
                            this.render();
                        }, 800);
                    }
                }
            }
            reset() { this.first = null; this.locked = false; }
            render() {
                this.container.innerHTML = `<div class="memory-grid">
                    ${this.cards.map((c, i) => `
                        <div class="memory-card ${c.flipped || c.matched ? 'flipped' : ''}" onclick="app.state.gameInstance.flip(${i})">
                            <i class="fa-solid ${c.icon}"></i>
                        </div>
                    `).join('')}
                </div>`;
            }
            destroy() { this.container.innerHTML = ''; }
        }

        // 3. HYPER CLICK
        class SpeedGame {
            constructor(container) { this.container = container; }
            init() {
                app.elements.instructions.innerText = "Click the pink targets. Don't miss.";
                this.score = 0;
                this.timer = 30; // 30 second round
                app.updateScore(0);
                this.container.innerHTML = `<div class="speed-stage" id="speed-stage"></div>`;
                this.spawn();
                
                // Game Loop
                this.interval = setInterval(() => {
                    this.timer--;
                    app.elements.instructions.innerText = `Time Remaining: ${this.timer}s`;
                    if(this.timer <= 0) {
                        clearInterval(this.interval);
                        document.getElementById('speed-stage').innerHTML = '';
                        app.showModal("Time's Up!", `Final Score: ${this.score}`, "fa-stopwatch", () => this.init());
                    }
                }, 1000);
            }
            spawn() {
                const stage = document.getElementById('speed-stage');
                if(!stage) return;
                stage.innerHTML = '';
                const t = document.createElement('div');
                t.className = 'speed-target';
                t.style.left = Math.random() * 260 + 'px'; // 320 - 60
                t.style.top = Math.random() * 260 + 'px';
                t.onmousedown = (e) => {
                    e.stopPropagation();
                    this.score += 50;
                    app.updateScore(this.score);
                    this.spawn();
                };
                stage.appendChild(t);
            }
            destroy() { clearInterval(this.interval); this.container.innerHTML = ''; }
        }

        // 4. DOTS LINK
        class DotsGame {
            constructor(container) { this.container = container; this.cols = ['#ef4444','#3b82f6','#22c55e','#eab308']; }
            init() {
                app.elements.instructions.innerText = "Click groups of 2+ matching dots.";
                this.grid = Array(36).fill(0).map(() => this.cols[Math.floor(Math.random()*4)]);
                this.score = 0;
                app.updateScore(0);
                this.render();
            }
            click(i) {
                const col = this.grid[i];
                if(!col) return;
                const group = this.flood(i, col, []);
                if(group.length >= 2) {
                    group.forEach(idx => this.grid[idx] = null);
                    this.score += group.length * 10;
                    app.updateScore(this.score);
                    this.drop();
                    this.render();
                }
            }
            flood(i, c, v) {
                if(i<0 || i>=36 || v.includes(i) || this.grid[i]!==c) return v;
                v.push(i);
                if(i%6!==0) this.flood(i-1,c,v);
                if(i%6!==5) this.flood(i+1,c,v);
                this.flood(i-6,c,v); this.flood(i+6,c,v);
                return v;
            }
            drop() {
                for(let c=0; c<6; c++) {
                    let w = 30+c;
                    for(let r=5; r>=0; r--) {
                        let idx = r*6+c;
                        if(this.grid[idx]!==null) {
                            if(idx!==w) { this.grid[w]=this.grid[idx]; this.grid[idx]=null; }
                            w-=6;
                        }
                    }
                    for(let r=0; r<6; r++) {
                        let idx=r*6+c;
                        if(this.grid[idx]===null) this.grid[idx]=this.cols[Math.floor(Math.random()*4)];
                    }
                }
            }
            render() {
                this.container.innerHTML = `<div class="dot-grid">
                    ${this.grid.map((c, i) => `<div class="dot" style="background:${c}" onclick="app.state.gameInstance.click(${i})"></div>`).join('')}
                </div>`;
            }
            destroy() { this.container.innerHTML = ''; }
        }

        // BOOT
        window.addEventListener('DOMContentLoaded', () => app.init());

    </script>
</body>
</html>
